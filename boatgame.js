class DragonBoatGame extends Phaser.Scene{constructor(){super({key:"DragonBoatGame"}),this.correctAnswersCount=0,this.totalQuestions=10,this.passThreshold=5,this.currentQuestionIndex=0,this.isWaterMoving=!0,this.isGameOver=!1}preload(){this.load.image("boat","assets/boat.png"),this.load.image("water","assets/bg.png"),this.load.image("obstacle","assets/stone.png"),this.load.image("zongzi","assets/rice.png"),this.load.text("questions","QA/QA.csv")}create(){var t=this.cameras.main.centerX,e=this.cameras.main.centerY,s=this.cameras.main.width,i=this.cameras.main.height,s=(this.water=this.add.tileSprite(t,e,s,i,"water"),this.water.setOrigin(.5,.5),.05*Math.min(this.cameras.main.width,this.cameras.main.height));this.titleText=this.add.text(t,e,"彰稅龍舟挑戰賽",{fontSize:s+"px",color:"#008080",padding:{x:20,y:10}}).setOrigin(.5),this.startButton=this.add.text(t,1.2*e,"Ready Go",{fontSize:s+"px",color:"#fff",backgroundColor:"#008000",padding:{x:10,y:5}}).setOrigin(.5).setInteractive(),this.startButton.on("pointerdown",()=>this.startGame())}startGame(){this.startTime=this.time.now,this.titleText.destroy(),this.startButton.destroy(),this.isGameStarted=!0;var t=this.cameras.main.centerX,e=(this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height),s=.04*Math.min(this.cameras.main.width,this.cameras.main.height),s=(this.correctAnswersText=this.add.text(t,.05*t," 彰稅龍舟賽\n答對題數:"+this.correctAnswersCount+"/"+this.passThreshold,{fontSize:s+"px",color:"#fff",backgroundColor:"#800080",padding:{x:10,y:8}}).setDepth(100).setOrigin(.5),3e-4*Math.min(this.cameras.main.width,this.cameras.main.height));this.boat=this.physics.add.sprite(t,e-100,"boat"),this.boat.setScale(s),this.boat.setCollideWorldBounds(!0),this.boat.setDrag(200),this.boat.setMaxVelocity(400),this.boat.setAngle(0),this.isSpinning=!1,this.isAnswering=!1,this.obstacles=this.physics.add.group(),this.zongzis=this.physics.add.group(),this.obstacleTimer=this.time.addEvent({delay:500,callback:this.spawnObstacle,callbackScope:this,loop:!0}),this.zongziTimer=this.time.addEvent({delay:3e3,callback:this.spawnZongzi,callbackScope:this,loop:!0}),this.physics.add.collider(this.boat,this.obstacles,this.hitObstacle,null,this),this.physics.add.overlap(this.boat,this.zongzis,this.collectZongzi,null,this),this.input.on("pointermove",t=>{var e;this.isSpinning||this.isAnswering||(e=this.cameras.main.width,this.boat.x=Phaser.Math.Clamp(t.x,0,e))});t=this.cache.text.get("questions").split("\n").filter(t=>0<t.trim().length);this.allQuestions=t.map(t=>{t=t.split(",");return{question:t[0].trim(),answers:[t[1].trim(),t[2].trim(),t[3].trim(),t[4].trim()],correctAnswer:t[5].trim()}}),this.questions=Phaser.Utils.Array.Shuffle(this.allQuestions).slice(0,this.totalQuestions),window.addEventListener("resize",resizeGame)}update(){!this.isGameOver&&this.isGameStarted&&(this.water.tilePositionY-=2,this.obstacles.children.iterate(t=>{t&&t.y>this.cameras.main.height&&t.destroy()}),this.zongzis.children.iterate(t=>{t&&t.y>this.cameras.main.height&&t.destroy()}))}spawnObstacle(){var t=Phaser.Math.Between(50,this.cameras.main.width-50),t=this.obstacles.create(t,-50,"obstacle"),e=35e-5*Math.min(this.cameras.main.width,this.cameras.main.height);t.setVelocityY(300),t.setScale(e),t.setImmovable(!0)}spawnZongzi(){var t=Phaser.Math.Between(50,this.cameras.main.width-50),t=this.zongzis.create(t,-40,"zongzi"),e=35e-5*Math.min(this.cameras.main.width,this.cameras.main.height);t.setVelocityY(200),t.setScale(e),t.setImmovable(!0)}hitObstacle(t,e){this.isSpinning=!0,t.setVelocity(0,0),t.setAngularVelocity(200),e.destroy(),this.time.delayedCall(1500,()=>{t.setAngularVelocity(0),t.setAngle(0),this.isSpinning=!1},[],this)}collectZongzi(t,e){this.isAnswering=!0,e.destroy(),this.showQuestion()}showQuestion(){let r=this.cameras.main.centerX,n=this.cameras.main.centerY;if(!(this.currentQuestionIndex>=this.questions.length)){this.isAnswering=!0,this.physics.pause(),this.obstacleTimer.paused=!0,this.zongziTimer.paused=!0,this.questionText&&(this.questionText.destroy(),this.answerButtons.forEach(t=>t.destroy()));let i=this.questions[this.currentQuestionIndex];this.currentQuestionIndex++;var t=Math.min(this.cameras.main.width,this.cameras.main.height);let a=Math.max(18,.03*t);this.questionText=this.add.text(r,+n,i.question,{fontSize:a+"px",color:"#fff",backgroundColor:"#008080",padding:{x:10,y:5}}).setOrigin(.5),this.selectedIndex=0,this.answerButtons=[];t=Phaser.Utils.Array.Shuffle([...i.answers]);this.answerButtons=[],t.forEach((t,e)=>{let s=this.add.text(r,1.15*n+e*(2*a),t,{fontSize:a+"px",color:"#fff",backgroundColor:"#008080",padding:{x:10,y:5}}).setOrigin(.5);s.setInteractive(),s.on("pointerdown",()=>{this.selectedIndex=e,this.answerButtons.forEach((t,e)=>{t.setColor(e===this.selectedIndex?"#ff0":"#fff")}),this.checkAnswer(s.text,i.correctAnswer)}),this.answerButtons.push(s)})}}updateSelectionColor(){this.answerButtons.forEach((t,e)=>{t.setColor(e===this.selectedIndex?"#ff0":"#fff")})}checkAnswer(t,e){var s=this.cameras.main.centerX,i=this.cameras.main.centerY,a=this.cameras.main.width,r=this.cameras.main.height,a=Math.min(a,r),r=Math.max(20,.05*a);t&&e&&((t=t.trim())===(e=e.trim())?(this.resultText=this.add.text(s,.85*i,"曆害喔！",{fontSize:r+"px",color:"#8B4513",padding:{x:10,y:5}}).setOrigin(.5),this.correctAnswersCount++,this.correctAnswersText.setText(` 彰稅龍舟賽
答對題數:${this.correctAnswersCount}/`+this.passThreshold)):this.resultText=this.add.text(s,.85*i,"再加油！",{fontSize:r+"px",color:"#708090",padding:{x:10,y:5}}).setOrigin(.5),this.time.delayedCall(500,()=>{this.questionText.destroy(),this.answerButtons.forEach(t=>t.destroy()),this.resultText.destroy(),this.physics.resume(),this.obstacleTimer.paused=!1,this.zongziTimer.paused=!1,this.isAnswering=!1,this.input.keyboard.enabled=!1,this.correctAnswersCount>=this.passThreshold?this.showVictoryScreen():this.currentQuestionIndex>=this.totalQuestions&&this.showGameOverScreen()}))}showVictoryScreen(){var t=this.cameras.main.centerX,e=this.cameras.main.centerY,s=this.cameras.main.width,i=this.cameras.main.height,s=Math.min(s,i),i=(Math.max(18,.04*s),Math.max(20,.05*s)),a=(this.graphics1=this.add.graphics(),this.graphics1.fillStyle(4286945,1),this.graphics1.fillRect(t-.5*s/2,e-.5*s/2,.5*s,.5*s),this.graphics1.setDepth(3),this.isGameOver=!0,this.isWaterMoving=!1,this.physics.pause(),this.obstacleTimer.paused=!0,this.zongziTimer.paused=!0,this.input.off("pointermove"),this.questionText&&(this.questionText.destroy(),this.answerButtons.forEach(t=>t.destroy())),this.add.text(t,e-.18*s,"恭喜過關！",{fontSize:i+"px",color:"#D2691E",fontFamily:"Arial, sans-serif"}).setDepth(5).setOrigin(.5),(this.time.now-this.startTime)/1e3);this.add.text(t,e-.1*s,"過關時間:"+a.toFixed(0)+"秒",{fontSize:i+"px",fill:"#fff",align:"center",fontFamily:"Arial, sans-serif"}).setDepth(5).setOrigin(.5),this.createTextButton(t,e,"Google 表單",i,()=>{window.open("https://forms.gle/your-google-form-link","_blank")}),this.createTextButton(t,e+.08*s,"再挑戰一次",i,()=>{this.restartGame()})}createTextButton(t,e,s,i,a){let r=this.add.text(t,e,s,{fontSize:i+"px",color:"#FFFFFF",fontFamily:"Arial, sans-serif",fontStyle:"bold",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setDepth(5).setInteractive();return r.on("pointerdown",a),r.on("pointerover",()=>r.setStyle({fill:"#FFD700"})),r.on("pointerout",()=>r.setStyle({fill:"#FFFFFF"})),r}showGameOverScreen(){var t=this.cameras.main.centerX,e=this.cameras.main.centerY,s=this.cameras.main.width,i=this.cameras.main.height,s=Math.min(s,i),i=(Math.max(18,.04*s),Math.max(20,.05*s));this.graphics1=this.add.graphics(),this.graphics1.fillStyle(4286945,1),this.graphics1.fillRect(t-.4*s/2,e-.4*s/2,.4*s,.4*s),this.graphics1.setDepth(3),this.isGameOver=!0,this.isWaterMoving=!1,this.physics.pause(),this.obstacleTimer.paused=!0,this.zongziTimer.paused=!0,this.input.off("pointermove"),this.add.text(t,.95*e,"再努力喔！",{fontSize:i+"px",color:"#A52A2A",padding:{x:20,y:10}}).setOrigin(.5).setDepth(5),this.createTextButton(t,e+.08*s,"再挑戰一次",i,()=>{this.restartGame()})}createTextButton(t,e,s,i,a){let r=this.add.text(t,e,s,{fontSize:i+"px",color:"#FFFFFF",fontFamily:"Arial, sans-serif",fontStyle:"bold",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setDepth(5).setInteractive();return r.on("pointerdown",a),r.on("pointerover",()=>r.setStyle({fill:"#FFD700"})),r.on("pointerout",()=>r.setStyle({fill:"#FFFFFF"})),r}restartGame(){this.correctAnswersCount=0,this.currentQuestionIndex=0,this.elapsedTime=0,this.isGameOver=!1,this.isGameStarted=!1,this.isWaterMoving=!0,this.input.keyboard.removeAllListeners(),this.scene.start("DragonBoatGame"),this.input.keyboard.enabled=!0,this.input.keyboard._hasQuestionListeners=!1,this.scene.restart()}}function resizeGame(){var t=window.innerWidth,e=window.innerHeight;game.scale.resize(t,e),game.cameras.main.setBounds(0,0,t,e),game.cameras.main.centerOn(t/2,e/2)}const config={type:Phaser.AUTO,width:window.innerWidth,height:window.innerHeight,physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:[DragonBoatGame]},game=new Phaser.Game(config);
